- name: Install Nagios with plugins
  apt:
    name:
      - nagios4
      - nagios-plugins-contrib
      - nagios-nrpe-plugin
    state: present
    update_cache: yes

- name: Copy custom Nagios configuration files
  template:
    src: "{{ item }}"
    dest: "/etc/nagios4/conf.d/{{ item | basename | regex_replace('\\.j2$', '') }}"
    mode: '0644'
  loop:
    - hosts.cfg.j2
  notify: Restart nagios

- name: Replace default Nagios configuration files
  template:
    src: "{{ item }}"
    dest: "/etc/nagios4/objects/{{ item | basename | regex_replace('\\.j2$', '') }}"
    mode: '0644'
  loop:
    - contacts.cfg.j2
  notify: Restart nagios
